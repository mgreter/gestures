if("undefined"==typeof OCBNET)var OCBNET={};
(function(b){var h={},f=[];OCBNET.Gestures=function(a){this.el=a;this.hands=[];this.maximum=this.fingers=0;this.finger={};this.ordered=[];this.handlers={};this.surface=h;this.elements=f;b(a).bind("fingerup",b.proxy(this.fingerUp,this)).bind("fingerdown",b.proxy(this.fingerDown,this)).bind("dragstart",function(){return!1});for(var l=0,c=this.init.length;l<c;l++)this.init[l].apply(this,arguments);f.push(b(a))};OCBNET.Gestures.Hand=function(){};OCBNET.Gestures.Finger=function(){};(function(a){a.init=
[];a.handler={};a.handle=function(l){var c=l.originalEvent;if(!c.data)if(c.data=!0,c=l.type.replace(/^trap/,""),this.handler[c])this.handler[c].apply(this,arguments);else throw"Gesture cannot handle unknown event",c;};a.fingerDown=function(l){var c=b(l.currentTarget),a=l.finger,c=c.data("gesture"),d=c.handlers;(b.isFunction(d.start)?d.start.call(c,l,a):d.start)&&-1==b.inArray(a.id,c.ordered)&&(c.fingers++,c.maximum<c.fingers&&(c.maximum=c.fingers),c.cached={},c.ordered.push(a.id),c.finger[a.id]=a,
h[a.id]=a,c.start={center:c.getCenter(),rotation:c.getRotation(),distance:c.getDistance()},c.move=b.extend({},c.start))};a.fingersMove=function(a,c){for(var g=f.length;g--;){var d=[],e=f[g].data("gesture"),m=e.handlers,n;for(n in e.finger)for(var k=a.length;k--;)a[k].id==n&&d.push(a[k]);if(d.length){delete e.cached.center;for(k=d.length;k--;){var h=d[k];b(f[g]).triggerHandler(new b.Event("fingermove",{finger:h}));e.finger[h.id]=h}e.move={center:e.getCenter(),rotation:e.getRotation(),distance:e.getDistance()};
e.center=e.move.center;e.rotation=e.move.rotation;e.distance=e.move.distance;var h=e.move.center.y,p=e.start.center.y,k=Math.abs(e.move.center.x-e.start.center.x),h=Math.abs(h-p);b(f[g]).triggerHandler(new b.Event("handmove",{gesture:e,fingers:d}));b.isFunction(m.move)&&m.move.call(e,d,c);b.isFunction(m.swipe)&&("undefined"==typeof e.swipeSector&&20<Math.sqrt(k*k+h*h)&&(k=180*Math.atan2(h,k)/Math.PI,e.swipeSector=parseInt(2*(k/90),10),e.swipeSector=Math.min(e.swipeSector,1)),"undefined"!=typeof e.swipeSector&&
(m.swipe.call(e,e.swipeSector,d,c),b(f[g]).triggerHandler(new b.Event("handswipe",{gesture:e,fingers:d}))));b.isFunction(m.transform)&&m.transform.call(e,d,c);b(f[g]).triggerHandler(new b.Event("handtransform",{gesture:e,fingers:d}))}}};a.fingerUp=function(a){var c=b(a.currentTarget),g=a.finger,d=c.data("gesture"),e=d.handlers,m=b.inArray(g.id,d.ordered);-1!=m&&(b.isFunction(e.stop)&&e.stop.call(d,g,a),b(c).triggerHandler(new b.Event("handstop",{gesture:d,finger:g})),d.stop={center:d.getCenter(),
rotation:d.getRotation(),distance:d.getDistance()},d.center=d.stop.center,d.rotation=d.stop.rotation,d.distance=d.stop.distance,delete d.swipeSector,d.fingers--,d.ordered.splice(m,1),delete d.finger[g.id],delete h[g.id])};a.getCenter=function(){if(this.cached.center)return this.cached.center;var a={},c=["page","client","screen"],b=["X","Y"],d;for(d in this.finger)for(var e=this.finger[d],h=c.length;h--;)for(var f=b.length;f--;){var k=c[h]+b[f];a[k]||(a[k]=0);a[k]+=e[k]/this.fingers}a.x=a.screenX;
a.y=a.screenY;return this.cached.center=a};a.getRotation=function(){if(this.cached.rotation)return this.cached.rotation;if(2>this.fingers)return 0;for(var a=0,c=0,b=0,d=0,e=this.ordered.length;d<e;d++)for(var h=this.finger[this.ordered[d]],f=d+1;f<e;f++){b++;var k=this.finger[this.ordered[f]],a=a+(k.screenX-h.screenX),c=c+(k.screenY-h.screenY)}return 180*Math.atan2(c/b,a/b)/Math.PI};a.getDistance=function(){if(this.cached.distance)return this.cached.distance;if(2>this.fingers)return 0;for(var a=0,
c=0,b=0,d=0,e=this.ordered.length;d<e;d++)for(var h=this.finger[this.ordered[d]],f=d+1;f<e;f++){b++;var k=this.finger[this.ordered[f]],a=a+Math.abs(k.screenX-h.screenX),c=c+Math.abs(k.screenY-h.screenY)}a/=b;c/=b;return Math.sqrt(a*a+c*c)}})(OCBNET.Gestures.prototype);b.fn.gesture=function(a){b(this).each(function(h,c){var g=b(c).data("gesture");"undefined"==typeof g&&(g=new OCBNET.Gestures(c),b(c).data("gesture",g));b.extend(g.handlers,a)})}})(jQuery);
(function(){var b={add:function(b){var f=b.handler;b.handler=function(a){var b=f.call(this,a);if(!1==b||a.isPropagationStopped()){var c=a.type,g=a.isTrigger,d=a.isPropagationStopped,e=a.isImmediatePropagationStopped;a.type="trap"+a.type;a.isPropagationStopped=function(){return!1};a.isImmediatePropagationStopped=function(){return!1};jQuery(a.target).trigger(a);a.type=c;a.isTrigger=g;d&&a.stopPropagation();e&&a.stopImmediatePropagation();if("undefined"!=typeof b)return b}}}};jQuery.event.special.mouseup=
b;jQuery.event.special.mouseout=b;jQuery.event.special.mouseover=b;jQuery.event.special.mousemove=b;jQuery.event.special.mousedown=b;jQuery.event.special.touchend=b;jQuery.event.special.touchmove=b;jQuery.event.special.touchstart=b;jQuery.event.special.touchcancel=b})();
(function(b){(function(h){var f=h.handler;f.touchstart=function(a){var f=a.currentTarget;b(a.originalEvent.changedTouches||[]).each(function(c,g){var d=new b.Event("fingerdown",{finger:{el:f,id:g.identifier,type:a.type,screenX:g.screenX,screenY:g.screenY,timeStamp:a.timeStamp,originalEvent:a.originalEvent}});b(f).trigger(d)})};f.touchend=function(a){var f=a.currentTarget;b(a.originalEvent.changedTouches||[]).each(function(c,g){var d=new b.Event("fingerup",{finger:{id:g.identifier,type:a.type,screenX:g.screenX,
screenY:g.screenY,timeStamp:a.timeStamp,originalEvent:a.originalEvent}});b(f).trigger(d)})};f.touchmove=function(a){var f=a.currentTarget,c=b(f).data("gesture"),g=[];b(a.originalEvent.changedTouches||[]).each(function(b,c){g.push({el:f,id:c.identifier,type:a.type,screenX:c.screenX,screenY:c.screenY,timeStamp:a.timeStamp,originalEvent:a.originalEvent})});c.fingersMove(g,a)};f.touchcancel=f.touchend;h.init.push(function(a){var f=b.proxy(this.handle,this),c=["start","move","end","cancel"],g;for(g in c){var d=
c[g];b(a).bind("touch"+d,f).bind("traptouch"+d,f)}})})(OCBNET.Gestures.prototype)})(jQuery);
