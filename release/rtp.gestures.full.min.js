if("undefined"==typeof OCBNET)var OCBNET={};
(function(d){var f={},m=[];OCBNET.Gestures=function(c){this.el=c;this.hands=[];this.maximum=this.fingers=0;this.finger={};this.ordered=[];this.handlers={};this.surface=f;this.elements=m;d(c).bind("fingerup",d.proxy(this.fingerUp,this)).bind("fingerdown",d.proxy(this.fingerDown,this)).bind("dragstart",function(){return!1});for(var b=0,a=this.init.length;b<a;b++)this.init[b].apply(this,arguments);m.push(d(c))};OCBNET.Gestures.Hand=function(){};OCBNET.Gestures.Finger=function(){};(function(c){c.init=
[];c.handler={};c.handle=function(b){var a=b.originalEvent;if(!a.data)if(a.data=!0,a=b.type.replace(/^trap/,""),this.handler[a])this.handler[a].apply(this,arguments);else throw"Gesture cannot handle unknown event",a;};c.fingerDown=function(b){var a=d(b.currentTarget),l=b.finger,a=a.data("gesture"),g=a.handlers;(d.isFunction(g.start)?g.start.call(a,b,l):g.start)&&-1==d.inArray(l.id,a.ordered)&&(a.fingers++,a.maximum<a.fingers&&(a.maximum=a.fingers),a.cached={},a.ordered.push(l.id),a.finger[l.id]=l,
f[l.id]=l,a.start={center:a.getCenter(),rotation:a.getRotation(),distance:a.getDistance()},a.move=d.extend({},a.start))};c.fingersMove=function(b,a){for(var l=m.length;l--;){var g=[],e=m[l].data("gesture"),c=e.handlers,h;for(h in e.finger)for(var k=b.length;k--;)b[k].id==h&&g.push(b[k]);if(g.length){delete e.cached.center;for(k=g.length;k--;){var f=g[k];e.finger[f.id]=f}e.move={center:e.getCenter(),rotation:e.getRotation(),distance:e.getDistance()};e.center=e.move.center;e.rotation=e.move.rotation;
e.distance=e.move.distance;var f=e.move.center.y,n=e.start.center.y,k=Math.abs(e.move.center.x-e.start.center.x),f=Math.abs(f-n);d.isFunction(c.move)&&c.move.call(e,g,a);d.isFunction(c.swipe)&&("undefined"==typeof e.swipeSector&&20<Math.sqrt(k*k+f*f)&&(k=180*Math.atan2(f,k)/Math.PI,e.swipeSector=parseInt(2*(k/90),10),e.swipeSector=Math.min(e.swipeSector,1)),"undefined"!=typeof e.swipeSector&&c.swipe.call(e,e.swipeSector,g,a));d.isFunction(c.transform)&&c.transform.call(e,g,a)}}};c.fingerUp=function(b){var a=
d(b.currentTarget),c=b.finger,a=a.data("gesture"),g=a.handlers,e=d.inArray(c.id,a.ordered);-1!=e&&(d.isFunction(g.stop)&&g.stop.call(a,c,b),a.stop={center:a.getCenter(),rotation:a.getRotation(),distance:a.getDistance()},a.center=a.stop.center,a.rotation=a.stop.rotation,a.distance=a.stop.distance,delete a.swipeSector,a.fingers--,a.ordered.splice(e,1),delete a.finger[c.id],delete f[c.id])};c.getCenter=function(){if(this.cached.center)return this.cached.center;var b={},a=["page","client","screen"],c=
["X","Y"],g;for(g in this.finger)for(var e=this.finger[g],d=a.length;d--;)for(var h=c.length;h--;){var k=a[d]+c[h];b[k]||(b[k]=0);b[k]+=e[k]/this.fingers}b.x=b.screenX;b.y=b.screenY;return this.cached.center=b};c.getRotation=function(){if(this.cached.rotation)return this.cached.rotation;if(2>this.fingers)return 0;for(var b=0,a=0,c=0,d=0,e=this.ordered.length;d<e;d++)for(var f=this.finger[this.ordered[d]],h=d+1;h<e;h++){c++;var k=this.finger[this.ordered[h]],b=b+(k.screenX-f.screenX),a=a+(k.screenY-
f.screenY)}return 180*Math.atan2(a/c,b/c)/Math.PI};c.getDistance=function(){if(this.cached.distance)return this.cached.distance;if(2>this.fingers)return 0;for(var b=0,a=0,c=0,d=0,e=this.ordered.length;d<e;d++)for(var f=this.finger[this.ordered[d]],h=d+1;h<e;h++){c++;var k=this.finger[this.ordered[h]],b=b+Math.abs(k.screenX-f.screenX),a=a+Math.abs(k.screenY-f.screenY)}b/=c;a/=c;return Math.sqrt(b*b+a*a)}})(OCBNET.Gestures.prototype);d.fn.gesture=function(c){d(this).each(function(b,a){var l=d(a).data("gesture");
"undefined"==typeof l&&(l=new OCBNET.Gestures(a),d(a).data("gesture",l));d.extend(l.handlers,c)})}})(jQuery);
(function(){var d={add:function(d){var m=d.handler;d.handler=function(c){var b=m.call(this,c);if(!1==b||c.isPropagationStopped()){var a=c.type,d=c.isTrigger,g=c.isPropagationStopped,e=c.isImmediatePropagationStopped;c.type="trap"+c.type;c.isPropagationStopped=function(){return!1};c.isImmediatePropagationStopped=function(){return!1};jQuery(c.target).trigger(c);c.type=a;c.isTrigger=d;g&&c.stopPropagation();e&&c.stopImmediatePropagation();if("undefined"!=typeof b)return b}}}};jQuery.event.special.mouseup=
d;jQuery.event.special.mouseout=d;jQuery.event.special.mouseover=d;jQuery.event.special.mousemove=d;jQuery.event.special.mousedown=d;jQuery.event.special.touchend=d;jQuery.event.special.touchmove=d;jQuery.event.special.touchstart=d;jQuery.event.special.touchcancel=d})();
(function(d){(function(f){var m=f.handler;if(!("ontouchstart"in window)){var c=function(b,a){b.button&&!b.originalEvent.which&&(b.button&1&&!a[1]?b.which=1:b.button&4&&!a[2]?b.which=2:b.button&2&&!a[3]&&(b.which=3))};m.mousewheel=function(b,a,c,g){a=d(b.data.el).data("gesture");for(var e=a.elements,f=e.length;f--;){a=e[f].data("gesture");var h=a.handlers;a.fingers&&(a.cached.rotation||(a.cached.rotation=0),a.cached.distance||(a.cached.distance=0),a.cached.rotation+=3*c,a.cached.distance+=5*g,a.move=
{center:a.getCenter(),rotation:a.getRotation(),distance:a.getDistance()},a.center=a.move.center,a.rotation=a.move.rotation,a.distance=a.move.distance,d.isFunction(h.transform)&&h.transform.call(a,a.finger,b))}};m.mousemove=function(b){var a=b.which,c=b.data.el,g=d(c).data("gesture"),e=[];for(a in g.surface)e.push({el:c,id:a,type:b.type,screenX:b.screenX,screenY:b.screenY,timeStamp:b.timeStamp,originalEvent:b.originalEvent});g.fingersMove(e,b)};m.mousedown=function(b){var a=b.which,l=b.currentTarget,
g=d(l).data("gesture");c(b,g.surface);0!=b.button&&b.preventDefault();var e=function(b){parseInt(a)===parseInt(b.which)&&g.handle.apply(g,arguments)},f=function(a){g.handle.apply(g,arguments)},h={el:l,id:a,handler:e,mover:f};b={el:l,id:b.which,type:b.type,screenX:b.screenX,screenY:b.screenY,timeStamp:b.timeStamp,originalEvent:b.originalEvent};var k=new d.Event("fingerdown",{finger:b});-1==d.inArray(b.id,g.ordered)&&(d(l).bind("mouseup",h,e).bind("mousemove",h,f).bind("mousewheel",h,e).bind("trapmouseup",
h,e).bind("trapmousemove",h,f).bind("trapmousewheel",h,e),d(document).bind("mouseup",h,e).bind("mousemove",h,f).bind("mousewheel",h,e).bind("trapmouseup",h,e).bind("trapmousemove",h,f).bind("trapmousewheel",h,e));d(l).trigger(k)};m.mouseup=function(b){var a={};a[b.which]=b.data;0>b.clientX||0>b.clientY||b.clientX>d(window).width()||d(window).height();for(var c in a){var g=a[c],e=g.el,f=g.mover,g=g.handler;d(e).data("hand");var h={el:e,id:parseInt(c),type:b.type,screenX:b.screenX,screenY:b.screenY,
timeStamp:b.timeStamp,originalEvent:b.originalEvent},h=new d.Event("fingerup",{finger:h});d(e).trigger(h);d(e).unbind("mouseup",g).unbind("mousemove",f).unbind("mousewheel",g).unbind("trapmouseup",g).unbind("trapmousemove",f).unbind("trapmousewheel",g);d(document).unbind("mouseup",g).unbind("mousemove",f).unbind("mousewheel",g).unbind("trapmouseup",g).unbind("trapmousemove",f).unbind("trapmousewheel",g)}};f.init.push(function(b){d(b).bind("mousedown",d.proxy(this.handle,this))})}})(OCBNET.Gestures.prototype)})(jQuery);
(function(d){(function(f){var m=f.handler;m.touchstart=function(c){var b=c.currentTarget;d(c.originalEvent.changedTouches||[]).each(function(a,f){var g=new d.Event("fingerdown",{finger:{el:b,id:f.identifier,type:c.type,screenX:f.screenX,screenY:f.screenY,timeStamp:c.timeStamp,originalEvent:c.originalEvent}});d(b).trigger(g)})};m.touchend=function(c){var b=c.currentTarget;d(c.originalEvent.changedTouches||[]).each(function(a,f){var g=new d.Event("fingerup",{finger:{id:f.identifier,type:c.type,screenX:f.screenX,
screenY:f.screenY,timeStamp:c.timeStamp,originalEvent:c.originalEvent}});d(b).trigger(g)})};m.touchmove=function(c){var b=c.currentTarget,a=d(b).data("gesture"),f=[];d(c.originalEvent.changedTouches||[]).each(function(a,d){f.push({el:b,id:d.identifier,type:c.type,screenX:d.screenX,screenY:d.screenY,timeStamp:c.timeStamp,originalEvent:c.originalEvent})});a.fingersMove(f,c)};m.touchcancel=m.touchend;f.init.push(function(c){var b=d.proxy(this.handle,this),a=["start","move","end","cancel"],f;for(f in a){var g=
a[f];d(c).bind("touch"+g,b).bind("traptouch"+g,b)}})})(OCBNET.Gestures.prototype)})(jQuery);
